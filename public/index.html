<!DOCTYPE html>
<html>
<head>
  <title>Assignment 1</title>
  <link href="/style.css" rel="stylesheet">
  <link rel="icon" type="image/x-icon" href="https://icons.veryicon.com/png/o/miscellaneous/color-work-icon/blockchain-2.png">
</head>
<body>
  <h1 align="center">Assignment 1</h1>
  <form id="transactionForm">
    <label for="sender">Sender:</label>
    <input type="text" id="sender" name="sender" required><br><br>
    
    <label for="receiver">Receiver:</label>
    <input type="text" id="receiver" name="receiver" required><br><br>
    
    <label for="amount">Amount:</label>
    <input type="number" id="amount" name="amount" required><br><br>
    
    <input  type="button" value="Add Transaction" onclick="addTransaction()">
    <button class="styled-button2" onclick="addBlock()">Add Block</button>

  </form>
  <div id="blockchain">

    <p class="data">Blockchain Data: </p>
  <button id="toggleBlockchainButton" class="styled-button" onclick="toggleBlockchainTable()">Table</button>
</div>
  <div id="blockchainTable"></div>



  <div id="merkleTree">
    <h2>Merkle Tree</h2>
    <div id="merkleLevels">
      <!-- Merkle Tree levels will be displayed here -->
    </div>
  </div>
<div id="transactiontable"></div>
  
  
<script src="main.js"></script>
<script>
      async function addBlock() {
      const data = prompt('Enter data for the new block:');
      if (data) {
        const response = await fetch('/addBlock', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ data }),
        });
        if (response.ok) {
          alert('Block added successfully');
          loadBlockchain();
        } else {
          alert('Error adding block');
        }
      }
    }
async function addTransaction() {
  const sender = document.getElementById('sender').value;
  const receiver = document.getElementById('receiver').value;
  const amount = document.getElementById('amount').value;

  if (!sender || !receiver || !amount) {
    alert('Please fill in all fields.');
    return;
  }

  const transaction = { sender, receiver, amount };
  const response = await fetch('/addTransaction', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({ transaction }),
  });

  if (response.ok) {
    alert('Transaction added successfully');
    loadBlockchain();
  } else {
    alert('Error adding transaction');
  }
}


  function displayBlockchainData(blockchain) {
    const blockchainTableDiv = document.getElementById('blockchainTable');
    blockchainTableDiv.innerHTML = ''; 

    if (blockchain.length === 0) {
      blockchainTableDiv.textContent = 'Blockchain is empty.';
      return;
    }

    blockchain = blockchain.slice().reverse();

    const table = document.createElement('table');
    const thead = document.createElement('thead');
    const tbody = document.createElement('tbody');
    const headerRow = document.createElement('tr');
    for (const key in blockchain[0]) {
      const th = document.createElement('th');
      th.textContent = key;
      headerRow.appendChild(th);
    }
    thead.appendChild(headerRow);

    blockchain.forEach(block => {
      const row = document.createElement('tr');
      for (const key in block) {
        const cell = document.createElement('td');
        cell.textContent = block[key];
        row.appendChild(cell);
      }
      tbody.appendChild(row);
    });

    table.appendChild(thead);
    table.appendChild(tbody);
    blockchainTableDiv.appendChild(table);
  }

  window.addEventListener('load', async () => {
    try {
      const response = await fetch('/getBlockchain');
      if (response.ok) {
        const blockchain = await response.json();
        displayBlockchainData(blockchain);
      } else {
        console.error('Error loading blockchain:', response.statusText);
      }
    } catch (error) {
      console.error('Error loading blockchain:', error);
    }
  });

  function toggleBlockchainTable() {
  const blockchainTable = document.getElementById('blockchainTable');
  const toggleButton = document.getElementById('toggleBlockchainButton');

  if (blockchainTable.style.display === 'none' || blockchainTable.style.display === '') {
    blockchainTable.style.display = 'block';
    toggleButton.textContent = 'Hide';
  } else {
    blockchainTable.style.display = 'none';
    toggleButton.textContent = 'Show';
  }
}


  </script>
</body>
</html>